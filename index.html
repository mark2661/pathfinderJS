<html>
    <link rel="stylesheet" href="style.css">
    <script src="Grid.js"></script>
    <script src="Search_Solutions.js"></script>
    <script src="settings.js"></script>
    <script src="CanvasState.js"></script>
    <script src="CanvasEditModeState.js"></script>
    <script src="CanvasSearchModeState.js"></script>
    <script src="MenuState.js"></script>
    <script src="MenuEditModeState.js"></script>
    <script src="MenuSearchModeState.js"></script>
    <script src="StateManager.js"></script>

    <head>
            <style>
                body { font: 14px 'Verdana', sans-serif; }
                select { font: 12px 'Verdana', sans-serif; }
                button { font: 12px 'Verdana', sans-serif; }
                table { font: 12px 'Courier', sans-serif; border-collapse: collapse; }
                th, td { text-align: center; padding: 4px; }
                tr:nth-child(odd) {background-color: #f2f2f2 };
                .multiselect { width: 200px; }
                .selectBox { position: relative; }
                .selectBox select { width: 100%; }
                .overSelect { position: absolute; left: 0; right: 0; top: 0; bottom: 0; }
                #checkboxes { display: none; border: 1px #dadada solid; }
                #checkboxes label {display: block; }
                #checkboxes label:hover { background-color: #1e90ff;}
            </style>
    </head>

    <script defer>
    function isMouseCursorOnCanvas(mouseX, mouseY, canvas) {
        let canvasDimensions = canvas.getBoundingClientRect();

        return mouseX > canvasDimensions.left && mouseX < canvasDimensions.right && mouseY > canvasDimensions.top && mouseY < canvasDimensions.bottom
    }

    init = function() {

        let stateManager = new StateManager();

        // set up the main loop
        setInterval(update, 1000 / 60);
        function update() {
        stateManager.currentState.canvas.draw();
        }


        let canvas = document.getElementById("grid-container").firstElementChild;
        let gridDim = canvas.getBoundingClientRect();

        document.addEventListener('mousemove', (event) => {
            let mouseX = event.pageX;
            let mouseY = event.pageY;

            if (isMouseCursorOnCanvas(mouseX, mouseY, canvas)) {
                offsetAdjustedMouseCoords = { "x": (mouseX - gridDim.left), "y": (mouseY - gridDim.top) }
                stateManager.currentState.canvas.setHover(offsetAdjustedMouseCoords.x, offsetAdjustedMouseCoords.y, true)
            }
            else {
                stateManager.currentState.canvas.deselectCurrentHoverCellKey();
            }
        });

        document.addEventListener("mousedown", (event) => {
            let mouseX = event.pageX;
            let mouseY = event.pageY;
            if (isMouseCursorOnCanvas(mouseX, mouseY, canvas)) {
                offsetAdjustedMouseCoords = { "x": (mouseX - gridDim.left), "y": (mouseY - gridDim.top) }

                if (stateManager.currentState.canvas.startCell === null){
                    stateManager.currentState.canvas.setStartCell(offsetAdjustedMouseCoords.x, offsetAdjustedMouseCoords.y);
                }

                else if (stateManager.currentState.canvas.goalCell === null) {
                    stateManager.currentState.canvas.setGoalCell(offsetAdjustedMouseCoords.x, offsetAdjustedMouseCoords.y);
                }
            }
        });
    }
    </script>

    <body onload="init()">
        <div id="main-container">
            <div id="grid-container"></div>
            <div id="menu-container">
                <div id="select-menu-container"></div>
                <div id="button-menu-container"></div>
            </div>
        </div>

        <!-- 20 wide 10 high -->
        <textarea id="defaultmap" style="display: none;">
            21111112222222222222 
            22222222222222222222 
            22222222222222211222 
            22222222222222211222 
            22222222222222211222 
            22222222222222211222 
            22222221111111111222 
            22222221111111111222 
            22222222222222222222 
            21111111111112222112 
            22222222222222222112 
            22222222222222222112 
            22222222222222222112 
            22222222222222222112 
            22222222222222222112 
            22222111111111222112 
            22222111111111222222
            22222222222211222222
            22222222222211222222
            22222222222211222222
            22222222222211222222
            22222222222211222222
            22222222222222222222 
            22222222222222222222 
        </textarea>
    </body>
</html>